
<div class="container">
    <h1 class="title" style="display: flex;justify-content: center;">Mercancias Registradas
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1D3A6C">
            <path
              d="m480-560-56-56 63-64H320v-80h167l-64-64 57-56 160 160-160 160ZM280-80q-33 0-56.5-23.5T200-160q0-33 23.5-56.5T280-240q33 0 56.5 23.5T360-160q0 33-23.5 56.5T280-80Zm400 0q-33 0-56.5-23.5T600-160q0-33 23.5-56.5T680-240q33 0 56.5 23.5T760-160q0 33-23.5 56.5T680-80ZM40-800v-80h131l170 360h280l156-280h91L692-482q-11 20-29.5 31T622-440H324l-44 80h480v80H280q-45 0-68.5-39t-1.5-79l54-98-144-304H40Z" />
          </svg>
    </h1>
    <div class="btns">
        <button class="button is-primary" (click)="abrirModal()">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                    width="24px" fill="#fff">
                    <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z" />
                </svg></span> Registrar Mercancia
        </button>

        <button class="button is-primary" [routerLink]="'/mercancia'">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#fff">
                <path
                    d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h240l80 80h320q33 0 56.5 23.5T880-640v242q-18-14-38-23t-42-19v-200H447l-80-80H160v480h120v80H160ZM640-40q-91 0-168-48T360-220q35-84 112-132t168-48q91 0 168 48t112 132q-35 84-112 132T640-40Zm0-80q57 0 107.5-26t82.5-74q-32-48-82.5-74T640-320q-57 0-107.5 26T450-220q32 48 82.5 74T640-120Zm0-40q-25 0-42.5-17.5T580-220q0-25 17.5-42.5T640-280q25 0 42.5 17.5T700-220q0 25-17.5 42.5T640-160Zm-480-80v-480 277-37 240Z" />
            </svg> Ver Total diario
        </button>
    </div>
    <div class="filter-container">
        <div class="search-box">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                    width="24px" fill="#000">
                    <path
                        d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z" />
                </svg></span>
            <input class="search-input" type="text" placeholder="Buscar..." [(ngModel)]="busqueda"
                (input)="filtrarMercancia()">

        </div>
    </div>
    <!-- Tabla dentro de un cuadro redondeado -->
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Proveedor</th>
                    <th>Fecha</th>
                    <th>Producto</th>
                    <th>Precio</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let mercancia of mercanciaFiltrados">
                    <td>{{ mercancia.proveedor }}</td>
                    <td>{{ mercancia.fecha | date:'dd/MM/yyyy'}}</td>
                    <td>{{ mercancia.producto }}</td>
                    <td>${{ mercancia.precio.toLocaleString('es-ES') }}</td>
                    <td style="display: none;">{{ mercancia.estado == 0 ? 'Anulado' : (mercancia.estado == 1 ? 'Activo'
                        : 'N/A') }}</td>
                    <td class="flex justify-center">
                        <div class="flex space-x-4">
                            <button
                                class="middle none center rounded-lg bg-orange-500 py-2 px-3 font-sans text-xs font-bold uppercase text-white shadow-md shadow-orange-500/20 transition-all hover:shadow-lg hover:shadow-orange-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                                data-ripple-light="true" (click)="abrirModalEdicion(mercancia)">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                    width="24px" fill="#fff">
                                    <path
                                        d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z" />
                                </svg>
                            </button>
                            <button
                                class="middle none center rounded-lg bg-blue-500 py-2 px-3 font-sans text-xs font-bold uppercase text-white shadow-md shadow-blue-500/20 transition-all hover:shadow-lg hover:shadow-red-blue/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                                data-ripple-light="true" (click)="abrirModalDetalles(mercancia)">

                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                    width="24px" fill="#fff">
                                    <path
                                        d="M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-72q-45 0-76.5-31.5T372-500q0-45 31.5-76.5T480-608q45 0 76.5 31.5T588-500q0 45-31.5 76.5T480-392Zm0 192q-146 0-266-81.5T40-500q54-137 174-218.5T480-800q146 0 266 81.5T920-500q-54 137-174 218.5T480-200Zm0-300Zm0 220q113 0 207.5-59.5T832-500q-50-101-144.5-160.5T480-720q-113 0-207.5 59.5T128-500q50 101 144.5 160.5T480-280Z" />
                                </svg>
                            </button>
                            <!-- Botón verde si estado es 1 -->
                            <button *ngIf="mercancia.estado == 1"
                                class="middle none center rounded-lg bg-green-500 py-2 px-3 font-sans text-xs font-bold uppercase text-white shadow-md shadow-green-500/20 transition-all hover:shadow-lg hover:shadow-red-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                                data-ripple-light="true" (click)="anularMercancia(mercancia)">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                    width="24px" fill="#fff">
                                    <path
                                        d="M280-240q-100 0-170-70T40-480q0-100 70-170t170-70h400q100 0 170 70t70 170q0 100-70 170t-170 70H280Zm0-80h400q66 0 113-47t47-113q0-66-47-113t-113-47H280q-66 0-113 47t-47 113q0 66 47 113t113 47Zm400-40q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35ZM480-480Z" />
                                </svg>
                            </button>

                            <!-- Botón rojo si estado es 0 -->
                            <button *ngIf="mercancia.estado == 0"
                                class="middle none center rounded-lg bg-red-500 py-2 px-3 font-sans text-xs font-bold uppercase text-white shadow-md shadow-red-500/20 transition-all hover:shadow-lg hover:shadow-red-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                                data-ripple-light="true" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                    width="24px" fill="#fff">
                                    <path
                                        d="M280-240q-100 0-170-70T40-480q0-100 70-170t170-70h400q100 0 170 70t70 170q0 100-70 170t-170 70H280Zm0-80h400q66 0 113-47t47-113q0-66-47-113t-113-47H280q-66 0-113 47t-47 113q0 66 47 113t113 47Zm0-40q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm200-120Z" />
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para registrar una nueva Mercancia -->
<div class="modal" [ngClass]="{'is-active': modalActivo && tipoModal == 'registrar' && !mercanciaSeleccionada._id}">
    <div class="modal-background" (click)="cerrarModal()"></div>
    <div class="modal-content">
        <!-- Contenido del modal -->
        <div class="box">
            <h1 class="title">Registrar Nueva Mercancía</h1>
            <form (ngSubmit)="registrarMercancia()" class="form">
                <div class="columns">
                    <!-- Primera columna -->
                    <div class="column">
                        <div class="field">
                            <label class="label">Proveedor <span class="has-text-danger">*</span></label>
                            <div class="control">
                                <input class="input" type="text" [(ngModel)]="nuevamercancia.proveedor" name="proveedor"
                                    required>
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Producto <span class="has-text-danger">*</span></label>
                            <div class="control">
                                <input class="input" type="text" [(ngModel)]="nuevamercancia.producto" name="producto"
                                    required>
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Descripcion</label>
                            <div class="control">
                                <input class="input" type="text" [(ngModel)]="nuevamercancia.descripcion"
                                    name="descripcion" required>
                            </div>
                        </div>
                    </div>
                    <!-- Segunda columna -->
                    <div class="column">
                        <div class="field">
                            <label class="label">Precio <span class="has-text-danger">*</span></label>
                            <div class="control">
                                <input class="input" type="number" [(ngModel)]="nuevamercancia.precio" name="precio"
                                    required>
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Fecha <span class="has-text-danger">*</span></label>
                            <div class="control">
                                <input class="input" type="date" [(ngModel)]="nuevamercancia.fecha" name="fecha"
                                    required>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- botones -->
                <div class="is-grouped buttons">
                    <div class="control">
                        <button
                            class="middle none center mr-4 rounded-lg bg-green-500 py-3 px-6 font-sans text-xs font-bold uppercase text-white shadow-md shadow-green-500/20 transition-all hover:shadow-lg hover:shadow-green-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                            data-ripple-light="true" type="button" (click)="registrarMercancia()">Registrar</button>
                    </div>
                    <div class="control">
                        <button
                            class="middle none center mr-4 rounded-lg bg-red-500 py-3 px-6 font-sans text-xs font-bold uppercase text-white shadow-md shadow-red-500/20 transition-all hover:shadow-lg hover:shadow-red-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                            data-ripple-light="true" type="button" (click)="cerrarModal()">Cancelar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close" (click)="cerrarModal()"></button>
</div>

<!-- Modal para actualizar una mercancia -->
<div class="modal" [ngClass]="{'is-active': modalActivo && tipoModal == 'editar' && mercanciaSeleccionada._id}">
    <div class="modal-background" (click)="cerrarModal()"></div>
    <div class="modal-content">
        <!-- Contenido del modal -->
        <div class="box">
            <h1 class="title">Actualizar Mercancia</h1>
            <form (ngSubmit)="editarMercancia()" class="form">
                <div class="columns">
                    <!-- Primera columna -->
                    <div class="column">
                        <div class="field">
                            <label class="label">Proveedor</label>
                            <div class="control">
                                <input class="input" type="text" [(ngModel)]="mercanciaSeleccionada.proveedor"
                                    name="proveedor" required disabled="true">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Producto</label>
                            <div class="control">
                                <input class="input" type="text" [(ngModel)]="mercanciaSeleccionada.producto"
                                    name="producto" required disabled="true">
                            </div>
                        </div>
                    </div>
                    <!-- Segunda columna -->
                    <div class="column">
                        <div class="field">
                            <label class="label">Precio</label>
                            <div class="control">
                                <input class="input" type="number" [(ngModel)]="mercanciaSeleccionada.precio"
                                    name="precio" required disabled="true">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Descripcion</label>
                            <div class="control">
                                <input class="input" type="text" [(ngModel)]="mercanciaSeleccionada.descripcion"
                                    name="descripcion" required>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="is-grouped buttons">
                    <div class="control">
                        <button
                            class="middle none center mr-4 rounded-lg bg-green-500 py-3 px-6 font-sans text-xs font-bold uppercase text-white shadow-md shadow-green-500/20 transition-all hover:shadow-lg hover:shadow-green-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                            data-ripple-light="true" type="submit">Actualizar</button>
                    </div>
                    <div class="control">
                        <button
                            class="middle none center mr-4 rounded-lg bg-red-500 py-3 px-6 font-sans text-xs font-bold uppercase text-white shadow-md shadow-red-500/20 transition-all hover:shadow-lg hover:shadow-red-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                            data-ripple-light="true" type="button" (click)="cerrarModal()">Cancelar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close" (click)="cerrarModal()"></button>
</div>

<!-- Modal para ver detalles de la mercancia -->
<div class="modal" [ngClass]="{'is-active': modalActivo && tipoModal == 'detalles' && mercanciaSeleccionada._id}">
    <div class="modal-background" (click)="cerrarModal()"></div>
    <div class="modal-content">
        <!-- Contenido del modal -->
        <div class="box">
            <h1 class="title">Detalles de la Mercancia</h1>
            <form (ngSubmit)="registrarMercancia()" class="form">
                <div class="columns">
                    <!-- Primera columna -->
                    <div class="column detalles-column">
                        <p class="detalles-item" style="text-decoration:underline;"><strong>Identificador:</strong> {{ mercanciaSeleccionada._id }}</p>
                        <p class="detalles-item"><strong>Proveedor:</strong> {{ mercanciaSeleccionada.proveedor }}</p>
                        <p class="detalles-item"><strong>Producto:</strong> {{ mercanciaSeleccionada.producto }}</p>
                        <p class="detalles-item"><strong>Precio:</strong> ${{ mercanciaSeleccionada.precio }}</p>
                        <p class="detalles-item"><strong>Descripción:</strong> {{ mercanciaSeleccionada.descripcion }}</p>
                        <p class="detalles-item"><strong>Fecha:</strong> {{ mercanciaSeleccionada.fecha | date:'dd/MM/yyyy'}}</p>
                        <p class="detalles-item">
                            <strong>Estado:</strong>
                            <span [ngClass]="{'text-green-500': mercanciaSeleccionada.estado == 1, 'text-red-500': mercanciaSeleccionada.estado == 0}">
                                {{ mercanciaSeleccionada.estado == 0 ? 'Anulado' : (mercanciaSeleccionada.estado == 1 ? 'Activo' : 'N/A') }}
                            </span>
                        </p>
                    </div>

                </div>
                <div class="is-grouped buttons">

                <!-- botones -->
                <button class="middle none center mr-4 rounded-lg bg-red-500 py-3 px-6 font-sans text-xs font-bold uppercase text-white shadow-md shadow-red-500/20 transition-all hover:shadow-lg hover:shadow-red-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:
                    shadow-none" data-ripple-light="true" type="button" (click)="cerrarModal()">
                    Cerrar
                </button>
                </div>
            </form>
        </div>
    </div>
</div>


    <!-- stylesheet -->
    <link rel="stylesheet" href="https://unpkg.com/@material-tailwind/html@latest/styles/material-tailwind.css" />

    <!-- Ripple Effect from cdn -->
    <script src="https://unpkg.com/@material-tailwind/html@latest/scripts/ripple.js"></script>